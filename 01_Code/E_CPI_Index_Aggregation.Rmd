

The following is a 5 pillar index

```{r}
library(readxl)
library(dplyr)
library(purrr)
library(writexl)


df <- read_excel("C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/data_latest.xlsx")
df <- df[, c(1, 2, 8, 10)]
df <- df %>% na.omit()

df_count <- df %>% group_by(CODE) %>% summarise(count = n())
listy <- df_count$CODE[df_count$count >= 27]
df <- df %>% filter(CODE %in% listy)


pillar_map <- list(
  P1 = c("Humidity", "Temperature", "WB_CCKP_HD45"), # Climatic Exposure
  P2 = c("Electricity generation-Clean-%", "EG.ELC.ACCS.UR.ZS", "EG.ELC.ACCS.RU.ZS",
         "EG.ELC.LOSS.ZS", "WB_RISE_EE_FMEE", "Energy_efficiency_mitigation_financing",
         "EnergyOverall score", "building_standards", "Hascoolingplan", "Built environmentOverall score"),
  P3 = c("building_standards", "Hascoolingplan", "Built environmentOverall score"), # Institutional & Regulatory
  P4 = c("Access to finance", "Skills", "Industry activity", 
         "Research and Development", "Energy_efficiency_mitigation_financing"), # Economic
  P5 = c("ICT", "SPI.D3.13.CLMT", "SPI.D3.7.ENRG", "SPI.D3.11.CITY", 
         "SPI.D3.1.POV", "SPI.D3.10.NEQL", "SPI.D3.5.GEND", "SPI.DIM1.5.INDEX") # Digital & Data
)

pillar_weights <- c(P1 = 0.15, P2 = 0.30, P3 = 0.20, P4 = 0.20, P5 = 0.15)

within_weights <- list(
  P1 = c(0.3, 0.4, 0.3),  
  P2 = c(0.15, 0.10, 0.10, 0.05, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10), 
  P3 = c(0.3, 0.3, 0.4),
  P4 = c(0.25, 0.20, 0.20, 0.20, 0.15),
  P5 = c(0.25, 0.15, 0.15, 0.10, 0.10, 0.10, 0.05, 0.10)
)


lower_is_better <- c("EG.ELC.LOSS.ZS", "Humidity", "Temperature", "WB_CCKP_HD45")
year_cols <- as.character(c(2020,2022))

df_norm <- df %>%
  group_by(Indicator) %>%
  mutate(across(all_of(year_cols), ~ {
    min_val <- min(pick(all_of(year_cols)), na.rm = TRUE)
    max_val <- max(pick(all_of(year_cols)), na.rm = TRUE)
    norm_val <- (.-min_val) / (max_val - min_val)
    if (unique(Indicator) %in% lower_is_better) norm_val <- 1 - norm_val
    norm_val
  })) %>%
  ungroup()


get_pillar_score <- function(df, indicators, weights, year_cols) {
  df %>%
    filter(Indicator %in% indicators) %>%
    mutate(weight = rep(weights, each = n() / length(weights))) %>%
    group_by(CODE) %>%
    summarise(across(all_of(year_cols), ~ weighted.mean(.x, weight, na.rm = TRUE))) %>%
    ungroup()
}


pillar_scores <- list()
for (p in names(pillar_map)) {
  pillar_scores[[p]] <- get_pillar_score(df_norm, pillar_map[[p]], within_weights[[p]], year_cols)
  names(pillar_scores[[p]])[2:(length(year_cols)+1)] <- paste0(year_cols, "_", p)
}


final_df <- reduce(pillar_scores, full_join, by = "CODE")


for (year in year_cols) {
  final_df[[paste0(year, "_CoolingIndex")]] <-
    (final_df[[paste0(year, "_P1")]] * pillar_weights["P1"]) +
    (final_df[[paste0(year, "_P2")]] * pillar_weights["P2"]) +
    (final_df[[paste0(year, "_P3")]] * pillar_weights["P3"]) +
    (final_df[[paste0(year, "_P4")]] * pillar_weights["P4"]) +
    (final_df[[paste0(year, "_P5")]] * pillar_weights["P5"])
}


write_xlsx(final_df, "C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/Weighted_Cooling_Index_5Pillars.xlsx")
write_xlsx(df_norm, "C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/df_norm_5Pillars.xlsx")





```


This one is the same index, with a higher weight being placed on the governance pillar
```{r}

# === Libraries ===
library(readxl)
library(dplyr)
library(purrr)
library(writexl)


df <- read_excel("C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/data_latest.xlsx")
df <- df[, c(1, 2, 8, 10)]
df <- df %>% na.omit()

df_count <- df %>% group_by(CODE) %>% summarise(count = n())
listy <- df_count$CODE[df_count$count >= 27]
df <- df %>% filter(CODE %in% listy)


pillar_map <- list(
  P1 = c("Humidity", "Temperature", "WB_CCKP_HD45"), # Climatic Exposure
  P2 = c("Electricity generation-Clean-%", "EG.ELC.ACCS.UR.ZS", "EG.ELC.ACCS.RU.ZS",
         "EG.ELC.LOSS.ZS", "WB_RISE_EE_FMEE", "Energy_efficiency_mitigation_financing",
         "EnergyOverall score", "building_standards", "Hascoolingplan", "Built environmentOverall score"), # Energy System
  P3 = c("building_standards", "Hascoolingplan", "Built environmentOverall score"), # Institutional & Regulatory
  P4 = c("Access to finance", "Skills", "Industry activity", 
         "Research and Development", "Energy_efficiency_mitigation_financing"), # Economic
  P5 = c("ICT", "SPI.D3.13.CLMT", "SPI.D3.7.ENRG", "SPI.D3.11.CITY", 
         "SPI.D3.1.POV", "SPI.D3.10.NEQL", "SPI.D3.5.GEND", "SPI.DIM1.5.INDEX") # Digital & Data
)


pillar_weights <- c(P1 = 0.15, P2 = 0.25, P3 = 0.30, P4 = 0.15, P5 = 0.15)


within_weights <- list(
  # Climatic Exposure — same as before
  P1 = c(0.3, 0.4, 0.3),  # Humidity, Temperature, WB_CCKP_HD45
  

  P2 = c(0.10, 0.10, 0.10, 0.05, 0.15, 0.10, 0.10, 0.10, 0.10, 0.10), 
  # Clean energy, Urban access, Rural access, Losses, EE framework, EE financing,
  # Energy score, Building standards, Cooling plan, Built env. score
  

  P3 = c(0.25, 0.45, 0.30),  
  # Building standards, Hascoolingplan (national/subnational), Built environment
  

  P4 = c(0.25, 0.20, 0.20, 0.15, 0.20), 
  # Access to finance, Skills, Industry, R&D, EE financing
  

  P5 = c(0.20, 0.15, 0.15, 0.10, 0.10, 0.10, 0.05, 0.15)
  # ICT, CLMT, ENRG, CITY, POV, NEQL, GEND, DIM1.5
)


lower_is_better <- c("EG.ELC.LOSS.ZS", "Humidity", "Temperature", "WB_CCKP_HD45")
year_cols <- as.character(c(2020,2022))

df_norm <- df %>%
  group_by(Indicator) %>%
  mutate(across(all_of(year_cols), ~ {
    min_val <- min(pick(all_of(year_cols)), na.rm = TRUE)
    max_val <- max(pick(all_of(year_cols)), na.rm = TRUE)
    norm_val <- (.-min_val) / (max_val - min_val)
    if (unique(Indicator) %in% lower_is_better) norm_val <- 1 - norm_val
    norm_val
  })) %>%
  ungroup()


get_pillar_score <- function(df, indicators, weights, year_cols) {
  df %>%
    filter(Indicator %in% indicators) %>%
    mutate(weight = rep(weights, each = n() / length(weights))) %>%
    group_by(CODE) %>%
    summarise(across(all_of(year_cols), ~ weighted.mean(.x, weight, na.rm = TRUE))) %>%
    ungroup()
}


pillar_scores <- list()
for (p in names(pillar_map)) {
  pillar_scores[[p]] <- get_pillar_score(df_norm, pillar_map[[p]], within_weights[[p]], year_cols)
  names(pillar_scores[[p]])[2:(length(year_cols)+1)] <- paste0(year_cols, "_", p)
}

final_df <- reduce(pillar_scores, full_join, by = "CODE")


for (year in year_cols) {
  final_df[[paste0(year, "_CoolingIndex_GovernanceLed")]] <-
    (final_df[[paste0(year, "_P1")]] * pillar_weights["P1"]) +
    (final_df[[paste0(year, "_P2")]] * pillar_weights["P2"]) +
    (final_df[[paste0(year, "_P3")]] * pillar_weights["P3"]) +
    (final_df[[paste0(year, "_P4")]] * pillar_weights["P4"]) +
    (final_df[[paste0(year, "_P5")]] * pillar_weights["P5"])
}

# === 10. Save results ===
write_xlsx(final_df, "C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/Governance_Led_Cooling_Index.xlsx")
write_xlsx(df_norm, "C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/df_norm_GovernanceLed.xlsx")



```

Governance Led, with a cap being placed on cooling plans

```{r}

# === Load Libraries ===
library(readxl)
library(dplyr)
library(purrr)
library(writexl)

df <- read_excel("C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/data_latest.xlsx")
df <- df[, c(1, 2, 8, 10)]
df <- df %>% na.omit()

df_count <- df %>% group_by(CODE) %>% summarise(count = n())
listy <- df_count$CODE[df_count$count >= 27]
df <- df %>% filter(CODE %in% listy)

pillar_map <- list(
  P1 = c("Humidity", "Temperature", "WB_CCKP_HD45"), 
  P2 = c("Electricity generation-Clean-%", "EG.ELC.ACCS.UR.ZS", "EG.ELC.ACCS.RU.ZS",
         "EG.ELC.LOSS.ZS", "WB_RISE_EE_FMEE", "Energy_efficiency_mitigation_financing",
         "EnergyOverall score", "building_standards", "Hascoolingplan", "Built environmentOverall score"), 
  P3 = c("building_standards", "Hascoolingplan", "Built environmentOverall score"), 
  P4 = c("Access to finance", "Skills", "Industry activity", 
         "Research and Development", "Energy_efficiency_mitigation_financing"), 
  P5 = c("ICT", "SPI.D3.13.CLMT", "SPI.D3.7.ENRG", "SPI.D3.11.CITY", 
         "SPI.D3.1.POV", "SPI.D3.10.NEQL", "SPI.D3.5.GEND", "SPI.DIM1.5.INDEX")
)


pillar_weights <- c(
  P1 = 0.15,  
  P2 = 0.25,  
  P3 = 0.25,  
  P4 = 0.20,  
  P5 = 0.15   
)


within_weights <- list(
  P1 = c(0.3, 0.4, 0.3),  
  P2 = c(0.10, 0.10, 0.10, 0.05, 0.15, 0.10, 0.10, 0.10, 0.10, 0.10),
  P3 = c(0.25, 0.45, 0.30),
  P4 = c(0.25, 0.20, 0.20, 0.15, 0.20),
  P5 = c(0.20, 0.15, 0.15, 0.10, 0.10, 0.10, 0.05, 0.15)
)

# === 5. Normalization (min–max) with exposure penalty & cap ===
lower_is_better <- c("EG.ELC.LOSS.ZS", "WB_CCKP_HD45")
exposure_vars <- c("Humidity", "Temperature")  # penalize hotter climates
cap_high <- c("SPI.D3.13.CLMT", "SPI.D3.7.ENRG", "SPI.D3.11.CITY",
              "SPI.D3.1.POV", "SPI.D3.10.NEQL", "SPI.D3.5.GEND",
              "SPI.DIM1.5.INDEX", "ICT", "Skills", "Access to finance")

year_cols <- as.character(c(2020, 2022))

df_norm <- df %>%
  group_by(Indicator) %>%
  mutate(across(all_of(year_cols), ~ {
    min_val <- min(pick(all_of(year_cols)), na.rm = TRUE)
    max_val <- max(pick(all_of(year_cols)), na.rm = TRUE)
    norm_val <- (.-min_val) / (max_val - min_val)
    ind <- cur_group()$Indicator[1]

    # Flip for lower-is-better indicators
    if (ind %in% lower_is_better) norm_val <- 1 - norm_val

    # Penalize exposure indicators (so hotter = worse)
    if (ind %in% exposure_vars) norm_val <- 1 - norm_val

    # Cap dominance of SPI/FTRI-like indicators
    if (ind %in% cap_high) norm_val <- pmin(norm_val, 0.9)

    norm_val
  })) %>%
  ungroup()

get_pillar_score <- function(df, indicators, weights, year_cols) {
  df %>%
    filter(Indicator %in% indicators) %>%
    mutate(weight = rep(weights, each = n() / length(weights))) %>%
    group_by(CODE) %>%
    summarise(across(all_of(year_cols), ~ weighted.mean(.x, weight, na.rm = TRUE))) %>%
    ungroup()
}

pillar_scores <- list()
for (p in names(pillar_map)) {
  pillar_scores[[p]] <- get_pillar_score(df_norm, pillar_map[[p]], within_weights[[p]], year_cols)
  names(pillar_scores[[p]])[2:(length(year_cols)+1)] <- paste0(year_cols, "_", p)
}


final_df <- reduce(pillar_scores, full_join, by = "CODE")


for (year in year_cols) {
  final_df[[paste0(year, "_CoolingIndex_BalancedGovernance")]] <-
    (final_df[[paste0(year, "_P1")]] * pillar_weights["P1"]) +
    (final_df[[paste0(year, "_P2")]] * pillar_weights["P2"]) +
    (final_df[[paste0(year, "_P3")]] * pillar_weights["P3"]) +
    (final_df[[paste0(year, "_P4")]] * pillar_weights["P4"]) +
    (final_df[[paste0(year, "_P5")]] * pillar_weights["P5"])
}


pillar_sd <- final_df %>%
  summarise(across(contains("_P"), sd, na.rm = TRUE))
print(pillar_sd)


write_xlsx(final_df, "C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/Balanced_Governance_Cooling_Index.xlsx")
write_xlsx(df_norm, "C:/Users/AHMAD/OneDrive/UNDPNYCINDICES/Original_Cooling_Index/df_norm_BalancedGovernance.xlsx")




```